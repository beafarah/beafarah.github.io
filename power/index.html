<!DOCTYPE html> <html lang="en"> <head> <meta name="google-site-verification" content=""/> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>power calculator | Beatriz FARAH</title> <meta name="author" content="Beatriz FARAH"/> <meta name="description" content="Beatriz Farah's website "/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.jpg"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://beafarah.github.io/power/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Beatriz </span>FARAH</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">talks</a> </li> <li class="nav-item active"> <a class="nav-link" href="/power/">power calculator<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <h2>power for test of equality of quantiles</h2> <p>Power calculator based on the test of equality of quantiles as described in the paper <a href="https://arxiv.org/abs/2505.03234" target="_blank" rel="noopener noreferrer">“Univariate and multivariate tests of equality of quantiles with right-censored data”</a>. This calculator assumes exponential distributions for control and censoring times, with balanced groups. The default parameters are the ones that correspond to some of the simulations from section 3.1 of our paper.</p> <p>You can choose the model type: <em>Proportional hazards</em> (exponential experimental arm), and <em>Nonproportional hazards with late treatment effects</em> (piecewise exponential experimental arm).</p> <p>Enter the parameters and click on <strong>Calculate</strong> to view the analytical power reached to detect a given difference in quantiles, or the minimum sample size required to attain a desired power, alongside the survival curves :)</p> <p><b>Choose calculation type:</b></p> <p><button onclick="setCalcType('power')">Power Calculation</button> <button onclick="setCalcType('samplesize')">Sample Size Calculation</button></p> <p>Current calculation: <span id="calc-type">Power</span></p> <p><b>Choose model type:</b></p> <p><button onclick="setModel('exponential')">Proportional</button> <button onclick="setModel('piecewise')">Nonproportional</button></p> <p>Current model: <span id="model-type">Exponential</span></p> <form id="power-form"> <label>Probability: <input type="number" id="prob" step="any" required="" value="0.5"></label><br> <label>Difference: <input type="number" id="diff" step="any" required="" value="0.1"></label><br> <div id="sample-size-block"> <label>Total Sample Size: <input type="number" id="sample-size" required="" value="1000"></label><br> </div> <div id="desired-power-block" style="display:none"> <label>Desired Power: <input type="number" id="desired-power" step="any" required="" value="0.9"></label><br> </div> <label>Rate of Control Arm: <input type="number" id="rate-control" step="any" required="" value="1.5"></label><br> <label>Rate of Censoring: <input type="number" id="rate-cens" step="any" required="" value="0.48"></label><br> <label>Significance Level (alpha): <input type="number" id="alpha" step="any" required="" value="0.05"></label><br> <div id="piecewise-options" style="display:none"> <label>Time Cutoff (tcut): <input type="number" id="tcut" step="any" value="0.2"></label><br> </div> <button type="submit">Calculate</button> </form> <p id="result"></p> <canvas id="survival-chart" width="800" height="400"></canvas> <style>button{background-color:lightgray;color:black;border:1px solid #888;padding:5px 10px;margin:2px;cursor:pointer;border-radius:4px}button.selected{background-color:green;color:white}</style> <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script> <script>function setCalcType(e){calcType=e,document.getElementById("calc-type").innerText="power"===e?"Power":"Sample Size",document.getElementById("sample-size-block").style.display="power"===e?"block":"none",document.getElementById("desired-power-block").style.display="samplesize"===e?"block":"none",document.querySelectorAll("button[onclick^='setCalcType']").forEach(e=>e.classList.remove("selected")),document.querySelector(`button[onclick="setCalcType('${e}')"]`).classList.add("selected")}function setModel(e){model=e,document.getElementById("model-type").innerText=e.charAt(0).toUpperCase()+e.slice(1),document.getElementById("piecewise-options").style.display="piecewise"===e?"block":"none",document.querySelectorAll("button[onclick^='setModel']").forEach(e=>e.classList.remove("selected")),document.querySelector(`button[onclick="setModel('${e}')"]`).classList.add("selected")}function normCDF(e){var t=e<0?-1:1,n=1/(1+.3275911*(e=Math.abs(e)/Math.sqrt(2)));return.5*(1+t*(1-((((1.061405429*n+-1.453152027)*n+1.421413741)*n+-.284496736)*n+.254829592)*n*Math.exp(-e*e)))}function inverseErf(e){let t=.147,n=Math.log(1-e*e),a=2/(Math.PI*t)+n/2,o=n/t;return Math.sign(e)*Math.sqrt(Math.sqrt(a*a-o)-a)}function normSInv(e){return Math.sqrt(2)*inverseErf(2*e-1)}function expo_pdf(e,t){return t*Math.exp(-t*e)}function piecewise_pdf(e,t,n,a){if(e<=a)return t*Math.exp(-t*e);return n*Math.exp(-t*a)*Math.exp(-n*(e-a))}function computePower(e,t,n,a,o,l,r){if(!isFinite(e)||e<=0||e>=1)return alert("Probability must be between 0 and 1 (exclusive)."),null;if(!isFinite(o)||o<=0||o>=1)return alert("Alpha must be between 0 and 1 (exclusive)."),null;if(!isFinite(r)||r<=0)return alert("Sample size must be positive."),null;if(!isFinite(n)||n<=0||!isFinite(a)||a<0)return alert("Rates must be non-negative (control rate > 0)."),null;const i=Math.abs(normSInv(1-o/2)),s=-Math.log(1-e)/n;let d,c,p;if("exponential"===model)d=-Math.log(1-e)/(s-t),c=s-t,p=d/(d+a)*(Math.exp((d+a)*c)-1);else{if(s-l<=t)return null;const o=1-Math.exp(-n*l);d=(Math.log(1-e)+n*l)/(l+t-s),c=e<o?-Math.log(1-e)/n:l-(Math.log(1-e)+n*l)/d,p=n/(n+a)*(Math.exp((n+a)*l)-1)+d/(d+a)*Math.exp((n-d)*l)*(Math.exp((d+a)*c)-Math.exp((d+a)*l))}if(!isFinite(d)||d<=0)return alert("Invalid experimental arm parameters (rateE \u2264 0)."),null;const u=n/(n+a)*(Math.exp((n+a)*s)-1);let m;if(m="exponential"===model?Math.pow(1-e,2)*(u/(.5*Math.pow(expo_pdf(s,n),2))+p/(.5*Math.pow(expo_pdf(c,d),2))):Math.pow(1-e,2)*(u/(.5*Math.pow(expo_pdf(s,n),2))+p/(.5*Math.pow(piecewise_pdf(c,n,d,l),2))),!isFinite(m)||m<=0)return alert("Error: invalid parameters (non-positive variance)."),null;const h=Math.sqrt(m/r);return{power:1-normCDF(i-t/h)+normCDF(-i-t/h),quantC:s,quantE:c,rateE:d}}let model="exponential",calcType="power";window.addEventListener("DOMContentLoaded",()=>{setCalcType(calcType),setModel(model)}),window.addEventListener("DOMContentLoaded",()=>{document.getElementById("power-form").addEventListener("submit",function(e){e.preventDefault();const t=parseFloat(prob.value),n=parseFloat(document.getElementById("diff").value),a=parseFloat(document.getElementById("rate-control").value),o=parseFloat(document.getElementById("rate-cens").value),l=parseFloat(document.getElementById("alpha").value),r="piecewise"===model?parseFloat(document.getElementById("tcut").value):null;let i;if("power"===calcType){const e=parseFloat(document.getElementById("sample-size").value);if(i=computePower(t,n,a,o,l,r,e),!i)return void alert("Invalid parameters");document.getElementById("result").innerHTML=`<b>Power: ${(100*i.power).toFixed(2)}%</b>`}else{const e=parseFloat(document.getElementById("desired-power").value);let s=10,d=0;for(;d<e&&s<5e5;){let e=computePower(t,n,a,o,l,r,s);if(!e)return void alert("Invalid parameters.");d=e.power,s+=2}document.getElementById("result").innerHTML=`<b>Minimum sample size per arm = ${Math.ceil(s/2)} (total n = ${s}, achieved power ${(100*d).toFixed(2)}%)</b>`,i=computePower(t,n,a,o,l,r,s)}const s=i.quantC,d=i.rateE,c=1.5*s,p=Array.from({length:100},(e,t)=>+(c*t/99).toFixed(2)),u=p.map(e=>Math.exp(-a*e)),m="exponential"===model?p.map(e=>Math.exp(-d*e)):p.map(e=>e<=r?Math.exp(-a*e):Math.exp(-a*r)*Math.exp(-d*(e-r))),h=document.getElementById("survival-chart").getContext("2d");window.survivalChartInstance&&window.survivalChartInstance.destroy(),window.survivalChartInstance=new Chart(h,{type:"line",data:{labels:p,datasets:[{label:"Control Arm",data:u,borderColor:"limegreen",fill:!1,tension:.3,borderWidth:2},{label:"Experimental Arm",data:m,borderColor:"darkgreen",fill:!1,tension:.3,borderWidth:2}]},options:{responsive:!0,plugins:{title:{display:!0,text:"Survival Functions",font:{size:18}},legend:{labels:{font:{size:14}}},tooltip:{callbacks:{label:function(e){return`${e.dataset.label}: ${e.parsed.y.toFixed(2)}`}}},annotation:{annotations:{hLine:{type:"line",yMin:1-t,yMax:1-t,borderColor:"green",borderWidth:2,borderDash:[6,6],label:{content:`1 - p = ${(1-t).toFixed(2)}`,enabled:!0,position:"start",backgroundColor:"rgba(0,0,0,0.7)",color:"#fff",font:{style:"italic"}}}}}},scales:{x:{title:{display:!0,text:"Time",font:{size:16}},ticks:{stepSize:.2,callback:e=>e.toFixed(1)}},y:{min:0,max:1,title:{display:!0,text:"Survival Probability",font:{size:16}},ticks:{stepSize:.2,callback:e=>e.toFixed(1)}}}}})})});</script> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>